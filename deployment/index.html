<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Deployment - Water MKDocs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Deployment";
    var mkdocs_page_input_path = "deployment.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Water MKDocs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../background/">Background</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Deployment</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#deploying-for-the-first-time">Deploying for the first time</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#subsequent-deployments">Subsequent deployments</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#staging-and-production-split">Staging and Production Split</a>
    </li>
    </ul>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../system/">System</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Water MKDocs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Deployment</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="production-deployment">Production Deployment</h1>
<p>The following tools are required to deploy the website:</p>
<ul>
<li><a href="https://devcenter.heroku.com/articles/heroku-cli">Heroku CLI</a></li>
<li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">Git</a></li>
</ul>
<h2 id="deploying-for-the-first-time">Deploying for the first time</h2>
<p>If you've never deployed the app from your computer, follow these instructions.</p>
<p>Note: the project name here is assumed to be <code>crwa-flagging</code>.</p>
<ol>
<li>If you have not already done so, pull the repository to your computer, and then change your directory to it.</li>
</ol>
<pre><code class="shell">git clone https://github.com/codeforboston/flagging.git
cd ./flagging
</code></pre>

<ol>
<li>Login to Heroku, and add Heroku as a remote repo using Heroku's CLI:</li>
</ol>
<pre><code class="shell">heroku login
heroku git:remote -a crwa-flagging
</code></pre>

<ol>
<li>Add the vault password as an environment variable to Heroku.</li>
</ol>
<pre><code class="shell">heroku config:set VAULT_PASSWORD=replace_me_with_pw
</code></pre>

<ol>
<li>Now deploy the app!</li>
</ol>
<pre><code class="shell">git push heroku master
</code></pre>

<ol>
<li>Now try the following:</li>
</ol>
<pre><code class="shell">heroku logs --tail
</code></pre>

<ol>
<li>If everything worked out, you should see the following at or near the bottom of the log:</li>
</ol>
<pre><code class="shell">2020-06-13T23:17:54.000000+00:00 app[api]: Build succeeded
</code></pre>

<p>If you see insted see something like <code>2020-06-13T23:17:54.000000+00:00 heroku[web.1]: State changed from starting to crashed</code>, then read the rest of the output to see what happened (there will likely be a lot of stuff, so dig through it). The most common error when deploying to production will be a <code>RuntimeError: Unable to load the vault; bad password provided</code> which is self-explanatory. Update the password, and the website will automatically attempt to redeploy. If you don't see that error, then try to self-diagnose.</p>
<ol>
<li>Go see the website for yourself!</li>
</ol>
<h2 id="subsequent-deployments">Subsequent deployments</h2>
<ol>
<li>
<p>Heroku doesn't allow you to redeploy the website unless you create a new commit. Add some updates if you need to with <code>git add .</code> then <code>git commit -m "describe your changes here"</code>.</p>
</li>
<li>
<p>Once you have done that, Heroku will simply redeploy the site when you merge your working branch:</p>
</li>
</ol>
<pre><code class="shell">git push heroku master
</code></pre>

<h2 id="staging-and-production-split">Staging and Production Split</h2>
<p>It is recommended, though not required, that you have both "staging" and "production" environments for the website (see <a href="https://en.wikipedia.org/wiki/Deployment_environment#Staging">here</a> for an explanation), and furthermore it is recommended you deploy to staging and play around with the website to see if it looks right before you deploy to prodution.</p>
<p>Managing effectively two separate Heroku apps from a single repository requires a bit of knowledge about how git works. Basically what you're doing is connecting to two separate remote git repositories. The default remote repo is called <code>heroku</code> and it was created by Heroku's CLI. But since you now have two Heroku remotes, the Heroku CLI doesn't know what it's supposed to name the 2nd one. So you have to manually name it using git.</p>
<ol>
<li>Run the following command to create a staging environment if it does not already exist.</li>
</ol>
<pre><code class="shell">heroku create crwa-flagging-staging
</code></pre>

<ol>
<li>Once it exists, add the staging environment as a remote; check to make sure all the remotes look right. The <code>heroku</code> remote should correspond with the production environment, and the <code>staging</code> remote should correspond with the staging environment you just created.</li>
</ol>
<pre><code class="shell">git remote add staging https://git.heroku.com/crwa-flagging-staging.git
git remote -v
</code></pre>

<ol>
<li>Now all of your <code>heroku</code> commands are going to require specifying the app, but the steps to deploy in staging are otherwise similar to the production deployment:</li>
</ol>
<pre><code class="shell">heroku config:set --app crwa-flagging-staging VAULT_PASSWORD=replace_me_with_pw
git push staging master
heroku logs --app crwa-flagging-staging --tail
</code></pre>

<ol>
<li>Check out the website and make sure it looks right.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../system/" class="btn btn-neutral float-right" title="System">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../background/" class="btn btn-neutral" title="Background"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../background/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../system/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
